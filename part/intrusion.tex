\section{Распознавание вторжений в БД}


\subsection{Основные понятия}

\textbf{Обнаружение вторжений} (применительно к БД) -- процесс выявления действий, 
которые способны нарушить конфиденциальность, целостность и доступность информации, 
хранимой в базе данных (БД).

\textbf{Система обнаружения вторжений} (СОВ) [согласно ФСТЭК] -- программное или программно-техническое 
средство, реализующие функции автоматизированного обнаружения (блокирования) действий в информационной системе, 
направленных на преднамеренный доступ к информации, специальные воздействия на информацию (носители информации) 
в целях ее добывания, уничтожения, искажения и блокирования доступа к ней.

Применение систем обнаружения вторжения относится к реактивным мерам (то есть к таким мерам, которые 
используются уже после того, как произошел инцидент) для противодействия активности злоумышленника в тех 
случаях, когда злоумышленник преодолел все проактивные меры. Поэтому обычно системы обнаружения вторжений 
являются \textit{вторичным фактором защиты в общей системе защиты} и предназначены для обнаружения и регистрации
уже произошедних событий, а также оповещение персонала при срабатывании определенных правил.

Если классифицировать методы обнаружения вторжения, используемые в системах обнаружения вторжений (СОВ), 
то можно выделить три типа (согласно классификации, предложенной Стефаном Аксельсоном [\cite{IDSClassification}]):
\begin{itemize}
	\item синтаксические методы (или методы поиска злоупотреблений, англ. misuse detection)
		К таким методам обычно относятся методы, которые основываются на обнаружения вторжений 
		путём сравнения SQL-запросов с шаблонами недопустимых синтаксических конструкций.
	\item методы обнаружения аномалий (англ. anomaly detection)
		Такие методы, наоборот, в отличие от первого типа, подрузамевают создание шаблонов нормального 
		поведения пользователя и последующее сравнение этих шаблонов с действиями, выполняемыми пользователями 
		во время работы с БД.
	\item смешанные методы, представляющие собой композицию первых двух
\end{itemize}


\subsection{Системы распознавания вторжений}

Системы обнаружения вторжения (англ. Intrusion Detection System, IDS) и 
системы предотвращения вторжений (англ. Intrusion Preventation System, IPS) 
обычно рассматриваются вместе, причем часто под термином система предотвращение вторжений подрузамевается
расширение систем обнаружения вторжений, так как IPS системы также должны обладать возможностью обнаружения
вторжений. Иначе говоря, IPS системы являются активными IDS системами.

В IDS системах, система также ответственна за реализацию ответных мер на нарушения: блокировка соединения,
настройки межсетевого экрана и прочее. Таким образом,

\textbf{Система обнаружения и предотвращения вторжений (IPS/IDS)} (применительно к БД) -- это 
программное или программно-техническое средство, предназначенное для выявления фактов 
неавторизованного доступа и предотвращания попыток несанкционированного доступа к БД.


\subsubsection{Типы моделей систем распознавания вторжений (ID-систем)}

Существует множество способов классификации СОВ, которые не являются однозначными или обязательными.
Следует рассмотреть наиболее известные и используемые классификации, которые характеризуют систему по:
\begin{itemize}
	\item \textbf{По способу мониторинга}
	\item \textbf{По способу анализа}
	\item \textbf{По скорости реакции}
	\item \textbf{По классу защиты}
\end{itemize}

\paragraph*{По способу мониторинга.}

\begin{itemize}
	\item \textbf{Сетевая СОВ (Network-based IDS, NIDS)} -- система, 
	которая занимается проверкой сетевого трафика с концентратора или коммутатора и анализируя сетевые пакеты.
	\item \textbf{Узловая СОВ (Host-based IDS, HIDS)} -- система, 
	отслеживающая вторжения, используя анализ системных вызовов, логов приложений, модификаций файлов 
	(исполняемых, файлов паролей, системных баз данных), состояния хоста и прочих источников. 
	\item \textbf{Основанная на прикладных протоколах СОВ (Application protocol-based IDS, APIDS)} -- система, 
	в которой ведется наблюдение за специализированными прикладными протоколами и анализ соответствующих 
	данных. Например, на веб-сервере с SQL базой данных СОВ будет отслеживать содержимое SQL команд, 
	передаваемых на сервер.
	\item \textbf{Гибридная СОВ} -- система, которая является композицией нескольких видов 
	систем обнаружения вторжений.
\end{itemize}

\paragraph*{По способу анализа.}

О данной классификации уже говорилось ранее. Она устроена на анализе событий, полученных из источника 
информации, и принимает решения, что происходит проникновение. Способами анализа являются 
\textbf{обнаружение злоупотреблений} и \textbf{обнаружение аномалий}.

\paragraph*{По скорости реакции.}

Определяют два типа СОВ по времени между получением информации из источника и ее анализом и принятием решения.
В зависимости от задержки во времени, СОВ разделятся на:
\begin{itemize}
	\item \textbf{с пакетным режимом (interval-based)}. В таких системах реакция происходит 
	через определенные интервалы времени, а информационный поток от точек мониторинга до инструментов анализа
	не является непрерывным.
	\item \textbf{непрерывные (real-time)}. В таких системах обрабатывается непрерывный поток информации 
	от источников. При этом таких тип является преобладающей типом в сетевых СОВ, которые получают 
	информацию из потока сетевого трафика.
\end{itemize}

\paragraph*{По классу защиты.}

Для каждой сертифицированной в России СОВ присваивается некоторый класс защиты 
согласно классификации ФСТЭК и выполненным требованиям для определенного профиля защиты (ПЗ).
Всего существует 6 классов, где самый низкий класс - шестой, а самый высокий - первый.

Согласно ФСТЭК СОВ разделяются на [\cite{IDSFSTEK}]:
\begin{itemize}
	\item \textbf{СОВ с 6 классом защиты}: применяются в информационных системах персональных данных 3 и 4 классов.
	\item \textbf{СОВ с 5 классом защиты}: применяются в информационных системах персональных данных 2 класса.
	\item \textbf{СОВ с 4 классом защиты}: применяются в государственных информационных системах, 
	в которых обрабатывается информация ограниченного доступа, не содержащая сведения, 
	составляющие государственную тайну, в информационных системах персональных данных 1 класса , 
	а также в информационных системах общего пользования II класса.
	\item \textbf{СОВ с 3, 2 или 1 классом защиты}: применяются в информационных системах, 
	в которых обрабатывается информация, содержащая сведения, составляющие государственную тайну.
\end{itemize}


\subsubsection{Общая структура ID-систем} 

\paragraph*{Архитектура СОВ.} Основные архитектурные компоненты СОВ: 
\begin{enumerate}
	\item \textbf{Host} -- система, на которые выполняется ПО СОВ.
	\item \textbf{Target} -- система, за которой наблюдает СОВ.
\end{enumerate}

Первоначально многие СОВ выполнялись на тех же системах, которые они защищали. 
Основная причина этого была в том, что большинство систем было mainframe, и стоимость выполнения СОВ 
на отдельном компьютере была очень большой. Это создавало проблему с точки зрения безопасности, так как 
любой атакующий, который успешно атаковал целевую систему, мог в качестве одной из компонент атаки просто 
запретить функционирование СОВ.

Но с появлением рабочих станций и персональных компьютеров в большинстве архитектур СОВ предполагается 
выполнение СОВ на отдельной системе, тем самым разделяя системы Host и Target. Это улучшает безопасность 
функционирования СОВ, так как в этом случае проще спрятать существование СОВ от атакующих.

\paragraph*{Компоненты современных СОВ:}

\begin{itemize}
	\item сенсор, который отслеживает события в сети или системе;
	\item анализатор событий, обнаруженных сенсорами;
	\item компонента принятия решения.
\end{itemize}

\paragraph*{Способы управления СОВ:}

\begin{itemize}
	\item \textbf{Централизованное управление}. При централизованных стратегиях управления весь 
	мониторинг, обнаружение и отчетность управляются непосредственно с единого "поста". 
	В этом случае существует единственная консоль СОВ, которая связана со всеми сенсорами, 
	расположенными в сети.
	\item \textbf{Частично распределенное управление}. Мониторинг и определение управляются с локально 
	управляемого узла, с иерархической отчетностью в одно или более центральных расположений.
	\item \textbf{Полностью распределенное управление}. Мониторинг и определение выполняются с 
	использованием подхода, основанного на агентах, когда решения об ответе делаются в точке анализа.
\end{itemize}

При этом в сети должны поддерживаться следующие связи:

\begin{itemize}
	\item связи для передачи отчетов СОВ. Эти связи создаются между сенсорами как сетевого мониторинга, так и мониторинга хоста, и центральной консолью СОВ;
	\item связи для мониторинга хостов и сетей;
	\item связи для выполнения ответов СОВ.
\end{itemize}


\subsubsection{Шаблоны классов пользователей}


\subsubsection{Модели известных атак}
\begin{itemize}
	\item Необычные запросы и команды администрирования SQL сервера, часто употребляемые взломщиками (DROP, CREATE и т.д.)
	\item Незаконные операции DELETE, UPDATE и INSERT
	\item Запросы, содержащие id администратора
	\item Обращение к служебным таблицам и скрытым данным
	\item Запросы, всегда возвращающие TRUE
	\item Попытка обнулить поля с паролем
	\item Внедрение в запросе OR, сравнения констант и другое
\end{itemize}


\subsection{Экспертные ID-системы}

Технологию построения экспертных систем часто называют инженерией знаний. Как правило, этот процесс требует специфической формы взаимодействия создателя экспертной системы, которого называют инженером знаний, и одного или нескольких экспертов в некоторой предметной области.  Инженер знаний <<извлекает>> из экспертов процедуры, стратегии,  эмпирические правила, которые они используют при решении задач, и  встраивает эти знания в экспертную систему. В результате появляется   компьютерная программа, которая решает задачи во многом так же, как   эксперты -- люди \autocite{ExpertSystems}.

В экспертных системах могут использоваться импликационные правила (Если [условие] то [действие]). Например:
\begin{itemize}
	\item ЕСЛИ с одного узла за время T поступает N пакетов, ТО записать в лог факт: происходит DoS атака (факт А)
	\item Если наблюдается более чем N фактов А, ТО записать в лог факт: происходит DDoS атака
\end{itemize}

\paragraph{Метрики}

\begin{itemize}
	\item \textbf{Показатель активности} -- величина, при превышении которой активность подсистемы оценивается как быстро прогрессирующая. В общем случае используется для обнаружения аномалий, связанных с резким ускорением в работе. Пример: среднее число записей аудита, обрабатываемых для элемента защищаемой системы в единицу времени.
	\item \textbf{Распределение активности в записях аудита} -- распределение во всех типах активности в актуальных записях аудита. Здесь под активностью понимается любое действие в системе, например, доступ к файлам, операции ввода-вывода.
	\item \textbf{Измерение категорий} -- распределение определенной активности в категории\footnotemark. Например, относительная частота количества регистраций в системе (логинов) из каждого физического места нахождения. Предпочтения в использовании программного обеспечения системы (почтовые службы, компиляторы, командные интерпретаторы, редакторы и т.д.)
	\item \textbf{Порядковые измерения} -- используется для оценки активности, поступающей в виде цифровых значений. Например, количество операция ввода-вывода, инициируемых каждым пользователем. Порядковые изменения вычисляют общую числовую статистику значений определенной активности, в то время как измерение категорий подсчитывает количество активностей.
\end{itemize}

\footnotetext{Здесь под \textit{категорией} понимается группа подсистем, объединенных по некоему общему принципу}

\subsubsection*{Статистические модели}

При обнаружении аномалий с использованием профайла в основном применяют статистические методы оценки. Процесс обнаружения происходит следующим образом: текущие значения измерений профайла сравнивают с сохраненными значениями. Результат сравнения - показатель аномальности в измерении. Общий показатель аномальности в простейшем случае может вычисляться при помощи некоторой общей функции от значений показателя аномалии в каждом измерении профайла.

Например, пусть $M_1, M_2, \dots, M_n$ -- измерения профайла, а $S_1, S_2, \dots, S_n$ -- соответственно представляют собой значения аномалии каждого из измерений. Чем больше число $S_i$, тем больше аномалии в $i$-ом показателе. Объединяющая функция может быть взвешенной суммой их квадратов:

\begin{equation}
	a_1s_1^2 + a_2s_2^2 + \dots + a_ns_n^2 > 0,
\end{equation}

где $a_i$ -- отражает относительный вес метрики $M_i$.

Параметры $M_1, M_2, \dots, M_n$ могут быть зависимыми друг от друга. В таком случае, объединяющая функция будет более сложной.

\subsubsection*{Профили}

Одним из способов формирования <<образа>> нормального поведения системы состоит в накоплении измерений значения параметров оценки в специальной структуре данных. Эта структура данных называется \textit{профайлом}. 

Основные требования, предъявляемые к структуре профайла:
\begin{itemize}
	\item Минимальный конечный размер
	\item Быстрое выполнение операции обновления
\end{itemize}

\paragraph{Примеры ID-систем}
\begin{enumerate}
	\item \textbf{GreenSQL-FW}. Работает как прокси-сервер между веб-приложением и SQL сервером. Анализирует SQL команды на предмет аномальных запросов.
	
	GreenSQL поддерживает несколько режимов работы:
	\begin{itemize}
		\item \textbf{Simulation Mode} -- пассивная система обнаружения атак (IDS). Протоколирует SQL запросы, выдает предупреждения на консоль управления.
		\item \textbf{Blocking Suspicious Commands} -- активная СОА. Атаки не только обнаруживаются, но и блокируются (IPS) в соответствии с установленными правилами, указывающими на аномальность запроса.
		\item \textbf{Active protection from unknown queries} -- блокирование всех неизвестных запросов (db firewall)
		\item \textbf{Learning mode} -- предназначен для прогона и настройки правил в <<чистой>> среде, что позволяет сформировать белый список и предотвратить в последствии ложные срабатывания анализатора запросов.
	\end{itemize}
	
	\item \textbf{Snort} -- свободная сетевая система предотвращения вторжений (IPS) и обнаружения вторжений (IDS) с открытым исходным кодом, способная выполнять регистрацию пакетов и в реальном времени осуществлять анализ трафика в IP-сетях. Способна выявлять атаки на SQL базы данных. 

	Особенности Snort:
	\begin{itemize}
		\item Возможность написания собственных правил
		\item Расширение функциональности с помощью подключения дополнительных модулей
		\item Гибкая система оповещения об атаках: Log-файлы, устройства вывода, БД и прочие
	\end{itemize}
	
\end{enumerate}

\subsection{Развитие систем распознавания вторжений}

% Так на сегодняшний день активно развиваются СОВ, работающие на основе прикладных протоколов, которые используются
% различными программами. К таким протоколам в частности относится SQL – язык описания запросов к реляционным базам данных.

Дальнейшие направления совершенствования связаны с внедрением в теорию и практику СОВ общей теории систем, методов синтеза и анализа информационных систем, конкретного аппарата теории распознавания образов. Эти разделы теории предполагают получение конкретных методов исследования для области систем СОВ.

До настоящего времени не описана СОВ как подсистема информационной системы в терминах общей теории систем. Необходимо обосновать показатель качества СОВ, элементный состав СОВ, ее структуру и взаимосвязи с информационной системой.

В связи с наличием значительного количества факторов различной природы, слаженная работа информационной системы и СОВ имеет вероятностный характер. Вследствие этого актуальным является обоснование вида вероятностных законов конкретных параметров функционирования. Особо следует выделить задачу обоснования функции потерь информационной системы, задаваемую в соответствии с ее целевой функцией на области параметров функционирования системы. При этом целевая функция должна быть определена не только на экспертном уровне, но и в соответствии с совокупностью параметров функционирования всей информационной системы и задачами, возложенными на нее. В таком случае показатель качества СОВ будет определяться как один из параметров, влияющих на целевую функцию, а его допустимые значения -- допустимыми значениями функции потерь.

После обоснования законов и функций, реальной задачей является получение оптимальной структуры СОВ в виде совокупности математических операций с помощью формализованных методов. Таким образом, может быть решена задача синтеза структуры СОВ. На основе полученных математических операций можно будет рассчитать зависимости показателей качества функционирования СОВ от параметров ее функционирования, а также от параметров функционирования информационной системы, то есть, будет возможен реальный анализ качества функционирования СОВ.

Сложность применения формализованного аппарата анализа и синтеза информационных систем к СОВ заключается в том, что конкретные реализации информационного комплекса и его подсистемы - СОВ состоят из разнородных элементов, которые могут описываться различными разделами теории (системами массового обслуживания, конечными автоматами, теорией вероятности, теорией распознавания образов и т.д.), то есть, рассматриваемый объект исследования является составным. В результате, математические модели, по-видимому, можно получить только для отдельных составных частей СОВ, что затрудняет анализ и синтез СОВ в целом. Однако, дальнейшая конкретизация применения формализованного аппарата анализа и синтеза позволит оптимизировать СОВ.

На основе изложенного можно сделать вывод о наличии в практической среде значительного опыта решения проблем обнаружения вторжений. Применяемые СОВ в значительной степени основаны на эмпирических схемах процесса обнаружения вторжений. Дальнейшее совершенствование СОВ связано с конкретизацией методов синтеза и анализа сложных систем, теории распознавания образов в применении к СОВ.